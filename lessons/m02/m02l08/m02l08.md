# Занятие 8: Интерактивные сайты и динамическое содержимое. Работа браузера и API

## 1. **Введение в интерактивные сайты**

### 1.1 **Описание работы браузера**
   - **Запрос и ответ**: Браузер отправляет HTTP-запросы на сервер для получения веб-страниц. Сервер отвечает с HTML-кодом, CSS, JavaScript и другими ресурсами.
   - **Парсинг и рендеринг**: После получения HTML-кода браузер парсит его, строя DOM (Document Object Model) дерево. Затем применяет CSS для оформления и создаёт CSSOM (CSS Object Model) дерево. Далее комбинирует DOM и CSSOM для создания Render Tree, на основе которого отображается страница.
   - **Выполнение JavaScript**: JavaScript-код выполняется в браузере, изменяя DOM и CSSOM, что может динамически изменять содержимое и стиль веб-страницы.
   - **Обработка событий**: Браузер также обрабатывает пользовательские события (клики, ввод текста и т.д.) и реагирует на них с помощью JavaScript.

### 1.2 **Особенности интерактивных сайтов**
   - **Динамическое обновление**: Интерактивные сайты могут изменять содержимое и структуру страницы без необходимости её перезагрузки. Это позволяет пользователю взаимодействовать с сайтом в реальном времени.
   - **Обмен данными**: Используются технологии, такие как AJAX и Fetch API, для загрузки данных с сервера асинхронно и обновления части страницы, не затрагивая всю страницу.
   - **Реактивный интерфейс**: На таких сайтах часто используются клиентские фреймворки и библиотеки (например, React, Vue.js) для создания динамических компонентов и управления состоянием интерфейса.
   - **Интерактивные элементы**: Включают формы, кнопки, модальные окна, анимации и другие элементы, которые реагируют на действия пользователя.

### 1.3 **Роль JavaScript в динамическом содержимом**
   - **Изменение DOM**: JavaScript позволяет изменять DOM (добавлять, удалять или изменять элементы и их атрибуты), что обеспечивает динамическое обновление страницы.
   - **Обработка событий**: JavaScript управляет пользовательскими событиями (например, кликами и вводом данных) и выполняет действия в ответ на эти события.
   - **Асинхронные запросы**: JavaScript использует AJAX и Fetch API для выполнения асинхронных запросов к серверу и получения данных без перезагрузки страницы.
   - **Интерактивные функции**: Реализует функции, такие как валидация форм, анимации, обновление данных в реальном времени, улучшая взаимодействие пользователя с сайтом.

### 1.4 **Различие между статическими и динамическими сайтами**
   - **Статические сайты**:
     - **Содержимое**: Генерируется на сервере один раз и не изменяется в зависимости от действий пользователя. Каждый запрос приводит к загрузке одинакового HTML-кода.
     - **Технологии**: Обычно используются простые HTML и CSS файлы. JavaScript может быть использован для базовой интерактивности, но основные данные и структура страницы остаются неизменными.
     - **Примеры**: Личные блоги, портфолио, простые корпоративные сайты.

   - **Динамические сайты**:
     - **Содержимое**: Генерируется на сервере на основе пользовательских запросов или данных, полученных в реальном времени. Содержимое может изменяться в зависимости от действий пользователя или других факторов.
     - **Технологии**: Используют серверные языки программирования (PHP, Python, Node.js) для генерации динамического HTML. JavaScript активно используется для взаимодействия с пользователем и обновления страницы без перезагрузки.
     - **Примеры**: Социальные сети, интернет-магазины, веб-приложения.


## 2. **Динамическое содержимое**

### 2.1 **Принципы работы AJAX и Fetch API**

- **AJAX (Asynchronous JavaScript and XML)**: AJAX позволяет веб-страницам асинхронно взаимодействовать с сервером, что обеспечивает обновление данных и интерфейса без полной перезагрузки страницы.
- **Fetch API**: Fetch API предоставляет более современный и простой способ выполнения HTTP-запросов. Использует промисы для асинхронной обработки.

### 2.2 **Загрузка данных без перезагрузки страницы**

- AJAX и Fetch API позволяют загружать данные асинхронно, что предотвращает необходимость перезагрузки страницы. Это делается через отправку запросов на сервер, получение ответов и обновление части веб-страницы.
- Например, когда пользователь заполняет форму или взаимодействует с элементами страницы, данные могут быть отправлены на сервер и получены обратно, что позволяет динамически изменять содержимое страницы.
- **Преимущества**: Улучшение пользовательского опыта за счет более быстрого и плавного взаимодействия с веб-приложением, без необходимости полной перезагрузки страницы.

### 2.3 **Примеры использования JavaScript для изменения DOM**

- **Изменение текста**: Вы можете изменять текст внутри элементов. Например, заменить текст внутри `<p>` элемента.
  ```javascript
  document.querySelector('a[href*="login"]').innerText = "New text content";
  ```

- **Добавление новых элементов**: Можно создавать новые элементы и добавлять их в DOM.
  ```javascript
  var newDiv = document.createElement('div');
  newDiv.innerHTML = '<a href="/login" target="_self" class="inline-block font-bold focus:outline-none focus-visible:ring focus:ring-primary-900 focus:ring-opacity-20 focus-visible:ring-offset-2 transition-all duration-300 ease-in-out px-4 py-[10px] text-sm bg-gray-200 text-primary-900 hover:border-2 hover:border-primary-900 border-2 border-transparent rounded-lg ">New text content</a>';
  
  document.querySelector('a[href*="login"]').appendChild(newDiv);
  ```

- **Удаление элементов**: Можно удалять элементы из DOM.
  ```javascript
  var element = document.querySelector('a[href*="login"]');
  if (element) {
      element.parentNode.removeChild(element);
  }
  ```

- **Изменение атрибутов**: Изменение атрибутов элементов, например, изменение `src` изображения или `href` ссылки.
  ```javascript
  document.querySelector('a[href*="login"]').href = '/';
  ```
### 2.4 **События и обработчики событий в JavaScript**

**События в JavaScript**  

- События — это действия, происходящие в браузере, которые можно перехватывать и обрабатывать. Примеры событий включают клики мыши, ввод данных с клавиатуры, перемещение мыши, изменение размера окна и т.д.

**Обработчики событий**

- Используются для выполнения функций при наступлении события. Обработчики могут быть назначены через метод `.addEventListener()` или с помощью HTML-атрибутов (`onclick`, `onchange` и т.д.).

## 3. **Анализ динамических сайтов сетевых запросов**

### Анализ динамических сайтов: сетевых запросов

Анализ сетевых запросов на динамическом сайте помогает понять, какие запросы отправляются на сервер, как данные передаются и каким образом можно их извлечь. Этот процесс включает использование инструментов разработчика браузера для отслеживания и анализа HTTP-запросов и ответов.

### 3.1 Анализ сетевых запросов

**Фильтрация и сортировка запросов**:
   - **Вкладка Network (Сеть)**: показывает все сетевые запросы, которые страница выполняет при загрузке и взаимодействии.
   - **Фильтрация по типу**: Используйте фильтры для отображения только интересующих вас типов запросов (например, XHR или Fetch для AJAX-запросов).
   - **Сортировка**: Вы можете отсортировать запросы по времени, типу или размеру для удобства анализа.

**Анализ запросов**:
   - **Выбор запроса**: Щелкните на интересующий вас запрос, чтобы увидеть подробную информацию.
   - **Вкладки**:
     - **Headers (Заголовки)**: Показывает заголовки запроса и ответа. Это включает URL, метод (GET, POST и т.д.), параметры, заголовки запроса (например, `User-Agent`, `Accept`) и заголовки ответа (например, `Content-Type`).
     - **Payload (Данные запроса)**: Для POST-запросов вы можете увидеть, какие данные были отправлены на сервер.
     - **Response (Ответ)**: Показывает данные, которые вернул сервер. Это может быть JSON, XML или HTML.
     - **Timing (Время)**: Позволяет увидеть время, затраченное на запрос, включая время ожидания и время загрузки.

### 3.2 Определение необходимых запросов
**Выявление важного запроса**:
   - Определите, какой запрос загружает данные, которые вам нужны. Это можно сделать, наблюдая за изменением данных на странице и соответствующим запросом в Network.
   - Проверьте, отправляется ли запрос при начальной загрузке страницы или в ответ на пользовательские действия (например, нажатие кнопки).

**Анализ параметров и заголовков**:
   - Обратите внимание на параметры запроса (например, в URL или в теле запроса) и заголовки. Возможно, они нужны для имитации запроса в вашем скрипте.
   - Параметры могут быть как в строке запроса, так и в теле POST-запроса.

## 4. Имитирование сетевых запросов

### 4.1 Определение необходимых составляющих запросов

Чтобы успешно имитировать сетевой запрос, необходимо понять его ключевые составляющие. Это включает в себя метод запроса, параметры, заголовки и формат данных. Давайте рассмотрим каждый из этих элементов более подробно:

1. **Методы запросов (GET, POST, и т.д.)**:
   - **GET**: Используется для запроса данных с сервера. Параметры запроса обычно передаются в строке URL.
   - **POST**: Используется для отправки данных на сервер (например, отправка формы). Параметры запроса передаются в теле запроса, а не в URL.
   - **PUT** и **DELETE**: Менее часто используемые методы, которые могут быть применены для обновления или удаления данных соответственно.

2. **Параметры запроса**:
   - **GET-параметры**: Включены в URL после знака вопроса (`?`). Например, в `https://example.com/api?param1=value1&param2=value2` параметры `param1` и `param2` передаются серверу.
   - **POST-параметры**: Передаются в теле запроса `body`.

3. **Заголовки запроса**:
   - Заголовки содержат метаинформацию о запросе, такую как тип содержимого, язык и информация о клиенте.
   - Примеры заголовков:
     - `User-Agent`: Информация о браузере или клиенте, выполняющем запрос.
     - `Accept`: Форматы данных, которые клиент может обработать (например, `application/json`).
     - `Content-Type`: Формат данных, отправляемых в запросе (например, `application/json` для JSON).

4. **Форматы данных**:
   - **JSON**: Часто используемый формат данных для API. Обычно указывается в заголовке `Accept` как `application/json`.
   - **XML**: Может использоваться для обмена данными в старых системах или некоторых API.
   - **HTML**: Ответ может быть HTML-документом, если API возвращает страницу или часть страницы.

### 4.2 Имитирование запросов с помощью `requests`

После определения необходимых составляющих запросов, вы можете использовать библиотеку `requests` в Python для имитации запросов. Ниже приведены примеры для различных типов запросов:

1. **Формирование запроса**:
   - **URL**: Полный адрес ресурса, к которому вы хотите обратиться.
   - **Параметры**: Данные, которые вы отправляете в запросе. Для GET-запросов они добавляются в URL, а для POST-запросов — в теле запроса.
   - **Заголовки**: Информация, которую вы отправляете вместе с запросом, как метаинформация.

2. **Примеры кода**:

   - **GET-запрос**:
     ```python
     import requests

     url = 'https://example.com/api/data'
     params = {
         'key1': 'value1',
         'key2': 'value2'
     }
     headers = {
         'User-Agent': 'Mozilla/5.0',
         'Accept': 'application/json'
     }

     response = requests.get(url, params=params, headers=headers)
     if response.status_code == 200:
         data = response.json()  # Если ответ в формате JSON
         print(data)
     else:
         print(f'Error: {response.status_code}')
     ```

   - **POST-запрос с JSON**:
     ```python
     import requests
     import json

     url = 'https://example.com/api/update'
     json_data = {
         'id': 123,
         'value': 'newvalue'
     }
     headers = {
         'User-Agent': 'Mozilla/5.0',
         'Content-Type': 'application/json'
     }

     response = requests.post(url, data=json.dumps(json_data), headers=headers)
     if response.status_code == 200:
         result = response.json()  # Если ответ в формате JSON
         print(result)
     else:
         print(f'Error: {response.status_code}')
     ```

   - **Обработка ответа**:
     - **Статус-код**: Проверка `response.status_code` позволяет убедиться, что запрос был успешным (например, код 200 означает успех).
     - **Формат данных**: Использование методов `response.json()` для JSON, `response.text` для HTML/XML для обработки содержимого ответа.

   - **Получение `authToken` стрима**
   ```python 
    import uuid
    import requests
    import json

    # https://watch.plex.tv/live-tv/channel/euronews-espanol
    url = 'https://plex.tv/api/v2/users/anonymous'
    headers = {
        'accept': 'application/json',
        'X-Plex-Client-Identifier': str(uuid.uuid4()),
        'X-Plex-Language': 'en',
        'X-Plex-Product': 'Plex Mediaverse',
        'X-Plex-Provider-Version': '6.3.0'
    }
    response = requests.post(url, headers=headers)
    response_json = json.loads(response.text)
    plex_token = response_json['authToken']
    print(plex_token)
   ```
   