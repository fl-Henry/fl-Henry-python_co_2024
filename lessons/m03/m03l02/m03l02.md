# Занятие 2: Введение в SQL: основные команды и синтаксис

## 1. Введение в SQL

### Определение SQL
SQL (Structured Query Language) — это стандартный язык программирования, используемый для управления и манипулирования реляционными базами данных. Он позволяет выполнять операции с данными, такие как их извлечение, добавление, обновление и удаление. SQL предоставляет пользователям возможность работать с данными в структурированном виде, что делает его незаменимым инструментом в области баз данных.

### История и развитие SQL
- **1970-е годы**: SQL был разработан в 1970-х годах в IBM для работы с реляционной моделью данных, предложенной Эдгаром Коддом. Первоначально язык назывался SEQUEL (Structured English Query Language), но позже был переименован в SQL из-за проблем с товарным знаком.
  
- **1986 год**: SQL был стандартизирован ANSI (American National Standards Institute), что способствовало его широкому распространению.

- **1992 год**: Вышел первый международный стандарт SQL (SQL-92), который добавил множество новых возможностей и расширил функциональность языка.

- **2000-е годы**: Развивались новые версии SQL, включая SQL:1999, SQL:2003 и последующие, которые добавили поддержку объектов, XML и других современных технологий.

- **Современные версии**: Сегодня SQL активно развивается, и многие реляционные СУБД (системы управления базами данных), такие как MySQL, PostgreSQL, Microsoft SQL Server и Oracle, используют его с собственными расширениями.

### Роль SQL в управлении базами данных
SQL играет ключевую роль в управлении реляционными базами данных, выполняя следующие функции:

- **Создание и изменение структуры базы данных**: С помощью команд DDL (Data Definition Language) SQL позволяет создавать таблицы, определять их структуру и вносить изменения в существующие схемы.

- **Манипуляция данными**: С помощью DML (Data Manipulation Language) SQL предоставляет возможности для извлечения, вставки, обновления и удаления данных в таблицах.

- **Управление доступом**: С помощью DCL (Data Control Language) SQL позволяет настраивать права доступа пользователей к базе данных, обеспечивая безопасность и контроль.

- **Обработка транзакций**: SQL поддерживает команды TCL (Transaction Control Language), позволяя выполнять операции с данными как единое целое (транзакции), что важно для обеспечения целостности данных.

- **Анализ и отчетность**: SQL используется для генерации отчетов и анализа данных, что позволяет бизнесу принимать обоснованные решения на основе информации.

## 2. Синтаксис SQL

### Основные правила написания SQL-запросов

1. **Регистр символов**:
   - SQL не чувствителен к регистру, то есть команды и ключевые слова могут быть написаны как в верхнем, так и в нижнем регистре. Однако рекомендуется использовать верхний регистр для ключевых слов (например, `SELECT`, `FROM`, `WHERE`) для повышения читаемости.

2. **Структура запроса**:
   - Стандартный синтаксис SQL-запроса состоит из ключевых слов и выражений, организованных в определённом порядке. Основная структура запроса `SELECT`:
     ```sql
     SELECT <столбцы>
     FROM <таблица>
     WHERE <условие>
     ORDER BY <столбец>;
     ```

3. **Разделение команд**:
   - Команды SQL разделяются точкой с запятой (`;`). Это необходимо для обозначения конца команды, особенно в сценариях с несколькими запросами.

4. **Имена объектов**:
   - Имена таблиц, столбцов и других объектов могут содержать буквы, цифры и символы подчеркивания, но не могут начинаться с цифры. Если имя содержит пробелы или специальные символы, его следует обрамлять в кавычки (например, `"имя таблицы"`).

5. **Комментарии**:
   - Однострочные комментарии можно добавлять с помощью `--`, многострочные — с помощью `/* ... */`.
   - Пример:
     ```sql
     -- Это однострочный комментарий
     /* Это
        многострочный
        комментарий */
     ```

6. **Форматирование и отступы**:
   - Хотя форматирование не обязательно, использование отступов и разбиение длинных запросов на несколько строк делает код более читаемым.

### Примеры синтаксиса

1. **Простой SELECT-запрос**:
   - Извлечение данных из таблицы.
   ```sql
   SELECT name, email FROM customers;
   ```

2. **SELECT с условием**:
   - Использование WHERE для фильтрации данных.
   ```sql
   SELECT * FROM customers WHERE id = 1;
   ```

3. **SELECT с сортировкой**:
   - Сортировка результатов по определенному столбцу.
   ```sql
   SELECT name, email FROM customers ORDER BY name ASC;
   ```

4. **INSERT-запрос**:
   - Добавление новой строки в таблицу.
   ```sql
   INSERT INTO customers (name, email) VALUES ('Jane Doe', 'jane@example.com');
   ```

5. **UPDATE-запрос**:
   - Обновление существующих данных.
   ```sql
   UPDATE customers SET email = 'jane.doe@example.com' WHERE id = 2;
   ```

6. **DELETE-запрос**:
   - Удаление данных из таблицы.
   ```sql
   DELETE FROM customers WHERE id = 2;
   ```

7. **JOIN-запрос**:
   - Объединение данных из нескольких таблиц.
   ```sql
   SELECT orders.id, customers.name
   FROM orders
   JOIN customers ON orders.customer_id = customers.id;
   ```

8. **Группировка и агрегатные функции**:
   - Использование GROUP BY и агрегатных функций, таких как COUNT, SUM, AVG.
   ```sql
   SELECT COUNT(*), customer_id FROM orders GROUP BY customer_id;
   ```

9. **Использование подзапросов**:
   - Вложенные запросы для получения данных.
   ```sql
   SELECT name FROM customers WHERE id IN (SELECT customer_id FROM orders);
   ```

10. **Работа с транзакциями**:
    - Пример использования TCL для управления транзакциями.
    ```sql
    BEGIN;
    INSERT INTO customers (name, email) VALUES ('Alice', 'alice@example.com');
    COMMIT;
    ```

## 3. Основные команды SQL

### DDL (Data Definition Language)

DDL (Data Definition Language) — это подмножество SQL, которое используется для определения, изменения и удаления структуры баз данных и их объектов. Команды DDL позволяют управлять схемами баз данных и определять, как данные будут организованы и храниться.

#### Основные команды DDL

1. **CREATE**
   - Используется для создания новых объектов в базе данных, таких как таблицы и индексы.
   - Пример создания таблицы:
     ```sql
     CREATE TABLE customers (
         id INT PRIMARY KEY,
         name VARCHAR(100),
         email VARCHAR(100)
     );
     ```
   - **Пояснение**: В этом примере создаётся таблица `customers` с тремя столбцами: `id`, `name` и `email`. Столбец `id` является первичным ключом, что обеспечивает уникальность каждой записи.

2. **ALTER**
   - Позволяет изменять существующие объекты базы данных, такие как добавление, изменение или удаление столбцов в таблицах.
   - Примеры:
     - Добавление нового столбца:
       ```sql
       ALTER TABLE customers ADD COLUMN phone VARCHAR(15);
       ```
     - Изменение типа данных столбца:
       ```sql
       ALTER TABLE customers ALTER COLUMN email SET DATA TYPE TEXT;
       ```
     - Удаление столбца:
       ```sql
       ALTER TABLE customers DROP COLUMN phone;
       ```
   - **Пояснение**: Команда `ALTER` обеспечивает гибкость в управлении структурой таблиц, позволяя адаптировать их к меняющимся требованиям.

3. **DROP**
   - Удаляет объекты базы данных, такие как таблицы, индексы или представления. Эта команда необратима и приводит к потере всех данных в удаляемом объекте.
   - Пример удаления таблицы:
     ```sql
     DROP TABLE customers;
     ```
   - **Пояснение**: Используя `DROP`, следует быть осторожным, так как все данные и структура удаляемого объекта будут безвозвратно потеряны.

4. **TRUNCATE**
   - Удаляет все строки из таблицы, но оставляет саму таблицу и её структуру. Это действие быстрее, чем `DELETE`, так как не записывает каждое удаление в журнал транзакций.
   - Пример:
     ```sql
     TRUNCATE TABLE customers;
     ```
   - **Пояснение**: Команда `TRUNCATE` позволяет быстро очистить таблицу, но не может использоваться с условиями и не возвращает удалённые данные.

5. **RENAME**
   - Позволяет переименовать существующие объекты, такие как таблицы и столбцы.
   - Пример:
     ```sql
     ALTER TABLE customers RENAME TO clients;
     ```
   - **Пояснение**: Эта команда полезна для изменения названий объектов в соответствии с изменениями в бизнес-логике или требованиями к структуре базы данных.

#### Дополнительные аспекты DDL

- **Индексы**: DDL также включает команды для создания индексов, которые улучшают производительность запросов.
  - Пример создания индекса:
    ```sql
    CREATE INDEX idx_email ON customers(email);
    ```
  - **Пояснение**: Индексы позволяют ускорить поиск по определённым столбцам, но могут замедлять операции вставки и обновления.

- **Представления**: DDL команды позволяют создавать виртуальные таблицы, которые представляют собой результаты SQL-запросов.
  - Пример создания представления:
    ```sql
    CREATE VIEW customer_emails AS SELECT name, email FROM customers;
    ```
  - **Пояснение**: Представления упрощают работу с данными и позволяют скрыть сложность запросов, но сами по себе не хранят данные.


### DML (Data Manipulation Language)

DML (Data Manipulation Language) — это подмножество SQL, которое используется для манипуляции данными в уже созданных объектах базы данных. Команды DML позволяют добавлять, изменять, извлекать и удалять данные, обеспечивая динамическое взаимодействие с содержимым базы данных.

#### Основные команды DML

1. **SELECT**
   - Используется для извлечения данных из одной или нескольких таблиц. Это одна из самых мощных и часто используемых команд в SQL.
   - Пример:
     ```sql
     SELECT name, email FROM customers;
     ```
   - **Пояснение**: В этом запросе извлекаются данные о именах и email клиентов из таблицы `customers`. Можно использовать различные условия и сортировки для управления выводом данных.

2. **INSERT**
   - Команда для добавления новых записей в таблицу. Позволяет вставлять одну или несколько строк.
   - Пример вставки одной записи:
     ```sql
     INSERT INTO customers (name, email) VALUES ('John Doe', 'john@example.com');
     ```
   - Пример вставки нескольких записей:
     ```sql
     INSERT INTO customers (name, email) VALUES ('Jane Doe', 'jane@example.com'), ('Alice Smith', 'alice@example.com');
     ```
   - **Пояснение**: Команда `INSERT` позволяет динамически добавлять данные в таблицы, что критично для работы с изменяемыми наборами данных.

3. **UPDATE**
   - Используется для изменения существующих данных в таблице. Позволяет обновлять одну или несколько строк на основе заданных условий.
   - Пример:
     ```sql
     UPDATE customers SET email = 'john.doe@example.com' WHERE id = 1;
     ```
   - **Пояснение**: Команда `UPDATE` позволяет актуализировать данные в таблицах. Важно использовать `WHERE`, чтобы избежать изменения всех записей в таблице.

4. **DELETE**
   - Удаляет одну или несколько записей из таблицы на основе заданных условий. Как и в случае с `UPDATE`, важно использовать `WHERE` для предотвращения удаления всех строк.
   - Пример:
     ```sql
     DELETE FROM customers WHERE id = 1;
     ```
   - **Пояснение**: Команда `DELETE` позволяет эффективно очищать данные в таблицах. Без условия `WHERE` она удалит все записи, что может привести к потере критической информации.

5. **MERGE**
   - Используется для вставки данных или обновления существующих на основе совпадения условий. Эта команда особенно полезна для объединения данных из разных источников.
   - Пример:
     ```sql
     MERGE INTO target_table AS target
     USING source_table AS source
     ON target.id = source.id
     WHEN MATCHED THEN
         UPDATE SET target.value = source.value
     WHEN NOT MATCHED THEN
         INSERT (id, value) VALUES (source.id, source.value);
     ```
   - **Пояснение**: Команда `MERGE` позволяет обрабатывать данные более эффективно, сводя к минимуму количество необходимых запросов для вставки и обновления.

#### Дополнительные аспекты DML

- **Условия и фильтры**: Команды DML могут использовать различные операторы для фильтрации данных. Например:
  - Оператор `WHERE` для фильтрации строк по определённым критериям.
  - Операторы сравнения (`=`, `>`, `<`, `LIKE`, `IN` и т.д.) для более сложных условий.

- **Агрегация**: При использовании `SELECT` можно применять агрегатные функции, такие как `COUNT`, `SUM`, `AVG`, `MIN`, `MAX`, для получения сводной информации.
  - Пример:
    ```sql
    SELECT COUNT(*) FROM customers;
    ```
  - **Пояснение**: Агрегатные функции позволяют собирать статистику и анализировать данные, что помогает принимать обоснованные бизнес-решения.

- **Группировка данных**: С помощью `GROUP BY` можно сгруппировать результаты по определённому полю.
  - Пример:
    ```sql
    SELECT COUNT(*), country FROM customers GROUP BY country;
    ```
  - **Пояснение**: Это позволяет получать сводные данные по категориям, что полезно для анализа.

### DCL (Data Control Language)

DCL (Data Control Language) — это подмножество SQL, которое используется для управления доступом к данным и объектам в базе данных. Команды DCL позволяют администраторам определять права пользователей, обеспечивать безопасность данных и контролировать, кто может выполнять определённые действия с данными.

#### Основные команды DCL

1. **GRANT**
   - Команда, которая предоставляет определённые права или разрешения пользователям или ролям на выполнение действий с объектами базы данных.
   - Пример:
     ```sql
     GRANT SELECT, INSERT ON customers TO user1;
     ```
   - **Пояснение**: В этом примере пользователю `user1` предоставляется право на выбор (SELECT) и добавление (INSERT) данных в таблицу `customers`. Это позволяет контролировать, кто может выполнять эти действия.

2. **REVOKE**
   - Используется для отмены ранее предоставленных прав или разрешений. Это позволяет ограничить доступ к данным и объектам базы данных.
   - Пример:
     ```sql
     REVOKE INSERT ON customers FROM user1;
     ```
   - **Пояснение**: В данном случае у пользователя `user1` отменяется право на добавление данных в таблицу `customers`. Это необходимо для обеспечения безопасности и контроля над доступом.

#### Дополнительные аспекты DCL

- **Управление ролями**:
  - В большинстве современных СУБД можно создавать роли, которые представляют собой набор прав. Это упрощает управление доступом, так как можно назначать роли пользователям вместо назначения прав каждому пользователю индивидуально.
  - Пример создания роли:
    ```sql
    CREATE ROLE data_entry;
    GRANT INSERT, UPDATE ON customers TO data_entry;
    GRANT data_entry TO user1;
    ```
  - **Пояснение**: Создание ролей позволяет более эффективно управлять доступом к данным, особенно в больших организациях.

- **Безопасность данных**:
  - DCL играет критическую роль в обеспечении безопасности данных, позволяя администраторам ограничивать доступ к чувствительной информации, защищать данные от несанкционированного доступа и обеспечивать выполнение политик безопасности.

- **Аудит и отслеживание доступа**:
  - Многие СУБД предоставляют функции аудита, которые позволяют отслеживать, кто и когда получал доступ к данным или выполнял изменения. Это может быть полезно для расследования инцидентов безопасности и обеспечения соблюдения нормативных требований.

### TCL (Transaction Control Language)

TCL (Transaction Control Language) — это подмножество SQL, которое используется для управления транзакциями в реляционных базах данных. Транзакции представляют собой последовательность операций, которые должны выполняться как единое целое, что гарантирует целостность данных. TCL позволяет контролировать, когда транзакции начинаются, завершаются или откатываются.

#### Основные команды TCL

1. **COMMIT**
   - Команда, которая фиксирует все изменения, сделанные в текущей транзакции. После выполнения `COMMIT` изменения становятся постоянными и не могут быть отменены.
   - Пример:
     ```sql
     COMMIT;
     ```
   - **Пояснение**: Использование `COMMIT` позволяет сохранить все операции, выполненные с данными, например, все вставленные, обновлённые или удалённые записи. Это критически важно для обеспечения целостности данных.

2. **ROLLBACK**
   - Команда, которая отменяет все изменения, сделанные в текущей транзакции, возвращая данные в состояние, существующее до начала транзакции.
   - Пример:
     ```sql
     ROLLBACK;
     ```
   - **Пояснение**: `ROLLBACK` используется в случае ошибок или если нужно отменить изменения. Это особенно полезно в сценариях, где необходимо обеспечить согласованность данных, например, если транзакция не может быть завершена успешно.

3. **SAVEPOINT**
   - Позволяет установить точку восстановления в пределах текущей транзакции. Если требуется откатить транзакцию, можно вернуться к этой точке, не отменяя все изменения, сделанные до этого момента.
   - Пример:
     ```sql
     SAVEPOINT save1;
     ```
   - **Пояснение**: `SAVEPOINT` предоставляет гибкость в управлении транзакциями, позволяя откатывать изменения до определённого момента, что может быть полезно в сложных операциях.

4. **SET TRANSACTION**
   - Команда, которая позволяет задавать свойства транзакции, такие как уровень изоляции (например, READ COMMITTED, SERIALIZABLE). Уровень изоляции определяет, как транзакции взаимодействуют друг с другом.
   - Пример:
     ```sql
     SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
     ```
   - **Пояснение**: Установка уровня изоляции помогает контролировать конкуренцию между транзакциями и предотвращать проблемы, такие как "грязные чтения" или "фантомные чтения".

#### Дополнительные аспекты TCL

- **Целостность данных**: TCL помогает поддерживать целостность данных, гарантируя, что все операции внутри транзакции либо выполняются успешно, либо отменяются. Это важный аспект при выполнении финансовых операций, где ошибка может привести к серьёзным последствиям.

- **Автоматические транзакции**: Во многих СУБД, если не указано иное, каждая команда выполняется как отдельная транзакция. Однако многие операции могут требовать явного управления транзакциями, чтобы обеспечить корректность и согласованность данных.

- **Производительность**: Эффективное использование транзакций может улучшить производительность работы с базами данных, поскольку минимизирует количество блокировок и снижает вероятность конфликтов между транзакциями.